---
title: "Atelier du 16 mars 2023"
subtitle: "Utilisation de modèles de régression à coefficients variant dans le temps dans le cadre de la prévision conjoncturelle"
author: "Claire du Campe de Rosamel & Alain Quartier-la-Tente"
format: 
  revealjs:
   smaller: true
editor: visual
---

## Introduction

Sur longue période, les institutions, les normes de sociétés ainsi que les comportements des agents économiques évoluent, induisant des changements dans la dynamique des séries économiques étudiées.

. . .

De nombreux modèles de l'Insee sont basés sur des régressions linéaires (CJO, prévisions, calage...) qui supposent que les relations entre les variables sont fixes dans le temps.

. . .

Hypothèse vraie sur le court-terme mais généralement fausse sur le long-terme ou en présence de changements structurels (changement de nomenclature, de définition, COVID...)

## Modèle de régression linéaire 

L'idée générale des modèles de régression linéaire est la suivante :

$$
\DeclareMathOperator{\argmin}{argmin}
y_t=\beta_0+\beta_1 x_{1,t}+\dots+\beta_p x_{p,t} +\varepsilon_t 
$$

$$
y_t=\beta X_t+\varepsilon_t
$$ 

Estimé grâce à la méthode des moindres carrés, sous les hypothèses de Gauss Markov.

. . .

On s'appuira sur un modèle linéaire simple pour illustrer la présentation : l'estimation du PIB grâce à deux variables explicatives, le climat des affaires et sa différence.

$$
PIB_t = \beta_0 + \beta_1 climat\_fr_t + \beta_2 diff\_climat\_fr_t + \epsilon_t
$$

. . . 

Version du modèles avec des coefficients variants :

$$
PIB_t = \beta_{0,t} + \beta_{1,t} climat\_fr_t + \beta_{2,t} diff\_climat\_fr_t + \epsilon_t
$$

##

PIB avec covid

![](graphs_atelier/plot_pib.svg)
##

Fitted lm

![](graphs_atelier/plot_lm.svg)

## Tests statistiques

On cherche à savoir si les coefficients sont stables au cours du temps. Utilisation de deux tests :

-   Bai et Perron

-   Nyblom et Hansen

. . .

Bai et Perron (2003) : proposition d'algorithme efficace pour trouver les dates de ruptures (package `strucchange`)

Mais ces tests supposent qu'il existe une date de rupture à déterminer, alors que l'on veut parfois juste savoir si les coefficients sont constants ou non.

Tests trouvés dans la littérature autour de Nyblom et Hansen (1992) : implémentation de ce test dans le package `tvCoef` (`hansen.test`)

------------------------------------------------------------------------

Limites de Bai Perron :

-   La rupture peut n'être que sur un sous-ensemble de variables, mais le test ne s'applique que sur l'ensemble d'un modèle

-   Peut détecter une date de rupture là où on aurait plutôt une évolution lente dans le temps et non brutale

. . .

Limites de Hansen :

-   Test de la l'instabilité de la variance (passer par d'autres tests)

-   Test joint ne s'applique pas aux indicatrices

Comme tout test, ils ont leurs limites, prendre les résultats avec précaution. Ex : même si le test de Hansen ne détecte pas d'instabilité, le test de Bai et Perron peu néanmoins détecter des ruptures.

## Régressions linéaires par morceaux

Modèles les plus simples :

$$
\exists t_1,\dots,t_{T-1}:\:
\beta_t = \beta_1\mathbb 1_{t< t_1} + \beta_2 \mathbb 1_{t_1 \leq t< t_2} + \dots + \beta_T \mathbb 1_{t_{T-1} \leq t}
$$

. . .

S'estime en découpant les régresseurs ($\mathbb V[\varepsilon_t]$ fixe dans le temps) ou en faisant des régressions linéaires par morceaux ($\mathbb V[\varepsilon_t]$ varie par sous-période).

Ce qui correspont à deux fonctions différentes dans le package : respectivement `piece_reg` et `bp.lms`.

. . .

Concentration plutôt sur `piece_reg` car donne une seule régression en sortie, contrairement à `bp.lms`.

Les estimations de coefficients restent les mêmes. Les seuls changements peuvent survenir sur la variance des sous-modèles qui peut différer de la variance du modèle d'ensemble. Et sur les estimations en temps réel.

------------------------------------------------------------------------

Avantages :

-   Simples à comprendre et à implémenter

-   Facilement combinable avec d'autres types de modèles (régressions locales)

Inconvénients :

-   Suppose l'existence une rupture brutale

-   Imprécisions dans le choix de la date


Dans le cas de notre modèle exemple, Bai et Perron détectent une rupture en 2011. Le modèle suivant est alors estimé :

$$
PIB_t = \beta_{0,t}1_{t< 2011} + \beta_{0,t}1_{t \ge 2011} 
+ \beta_{1,t}1_{t< 2011} climat\_fr_t + \beta_{1,t}1_{t \ge 2011} climat\_fr_t + 
\\
\beta_{2,t}1_{t < 2011} diff\_climat\_fr_t + \beta_{2,t}1_{t \ge 2011} diff\_climat\_fr_t + \epsilon_t 
$$

----

Fitted piecelm

![](graphs_atelier/plot_piecelm.svg)


## Régressions locales

Package `tvreg`

Hypothèse $\beta_t = \beta(z_t)$ avec par défaut $z_t = t/T$.

Et on suppose $\beta()$ localement constante (Nadaraya-Watson) ou localement linéaire.

. . .

Estimation :

$$
\beta(z_t) = \underset{\theta_0}{\argmin}\sum_{j=1}^T\left(y_{j}-x_j\theta_0\right)^2K_b(z_j-z_t)
$$

Avec $K_b(x)=\frac 1 b K(x/b)$ une fonction de noyau pour pondérer les observations. 

. . .

Remarque :

-   Problème du choix de $b$ : par validation croisée mais peu discriminant

-   Si $b\geq1$ on utilise toutes les données pour chaque estimation.

-   Si $b=20$ le poids donné à toutes les données se rapproche de 1, estimation $\simeq$ à la régression linéaire


------------------------------------------------------------------------

Inconvénient :

-   Tous les coefficients varient

-   Fortes révisions possibles en temps-réel : ajout d'un point, changement de b, noyau asymétrique

. . .

Remarque :

-   Possibilité de combiner les précédents modèles en runant une régression locale sur des données coupées selon Bai et Perron

-   Grâce à des paramètres ou fonctions, on peut fixer les coefficients de certaines variables. Egalement possible pour les régression par morceau.

----

Fitted tvlm

![](graphs_atelier/plot_tvlm.svg)

## Modèles espace-état

Modélisation espace-état est une méthodologie générale qui permet de traiter un grand nombre de problèmes de séries temporelle.

. . .

On suppose que le problème est déterminé par une série de vecteurs *non observés* $\alpha_1,\dots,\alpha_n$ associés aux observations $y_1,\dots,y_n$, la relation entre $\alpha_t$ et $y_t$ étant spécifiée par le modèle espace-état.

. . .

Plusieurs formes de modèles sont possibles, les plus simples étant les modèles linéaires gaussiens. Nous utilisons une version simplifiée sous la forme :

. . .

$$
\begin{cases}
y_t=X_t\alpha_t+\varepsilon_t,\quad&\varepsilon_t\sim\mathcal N(0,\sigma^2)\\
\alpha_{t+1}=\alpha_t+\eta_t,\quad&\eta_t\sim\mathcal N(0,\sigma^2 Q)
\end{cases},\text{ avec }\eta_t\text{ et }\varepsilon_t\text{ indépendants}
$$

avec $y_t$ de dimension $p\times 1$ vecteur des observations, et $\alpha_t$ de dimension $m \times 1$ vecteur d'états (*state vector*). Et $\sigma^2$ un facteur simplifiant les estimations.

. . .

La première équation est l'équation d'observation (*observation equation*) et la seconde l'équation d'état (*state equation*).

--------------

Pour simplifier les calculs et les rendre plus rapide (sutout en présence de beaucoup de données), cette méthode utilise certaines techniques permettant d'estimer tous les paramètres de manière dynamique, comme le filtre de Kalman.

. . .

Deux opérations classiques : *filtering* et *smoothing*

-   Filtering : estime le coefficient suivant (en $t+1$) avec les informations connues en t. Ce qui est proche des estimations en temps-réel.

$$
a_{t+1} = E[\alpha_t|Y_t]
$$

-   Smoothing : estime le coefficient à chaque date grâce à toute l'information disponible. Ce qui est proche des estimations dans l'échantillon.

$$
\hat\alpha_t=E[\alpha_t|y]
$$

----

Fitted ssm

![](graphs_atelier/plot_ssm.svg)

## Résultats

Quels modèles, quelle période, quelles conclusions ?
